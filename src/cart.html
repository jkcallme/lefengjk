<!DOCTYPE html>
<html lang="zh">

	<head>
		<meta charset="UTF-8" />
		<meta name="keywords" content="乐蜂网,乐蜂,化妆品网站,商品特卖,特卖网,特卖">
		<meta name="description" content="乐蜂网全新开启美妆特卖，每天10点上新！主营化妆品、保健品、服装配饰等品类，放心购物，45天无条件退换货！同时还是国内一家拥有众多签约美容专家、明星达人并提供全面女性时尚解决方案的女性时尚生活互动网站。">
		<link rel="icon" href="http://www.lefeng.com/favicon.ico" type="image/x-icon" //>
		<title>乐蜂网-美妆特卖_每日10点上新_品牌甄选!</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<link rel="stylesheet" href="css/cart.css" />
		<link rel="stylesheet" href="css/reset.css" />
		<style>

		</style>
		<title>Document</title>
	</head>

	<body>
		<div class="top">
			<div class="bot_main">
				<div class="wrapper">
					<ul class="first_right">
						<li>
							<a href="#">嗡，欢迎来到乐蜂，&nbsp;</a>
							<a href="#" class="f10">156********</a>

						</li>
						<li><span>|</span></li>
						<li>
							<a href="#" class="f10">退出登录</a>
						</li>
						<li>
							<a href="#" class="bot_left">我的订单
								<i></i></a>

						</li>
						<li>
							<a href="#" class="bot_left">快速导航
								<i></i></a>

						</li>

						<li>
							<a href="#">收藏乐蜂</a>
						</li>
						<li>

							<a href="#" class="bot_right f10"><i></i>手机乐蜂</a>
						</li>

					</ul>
				</div>
			</div>
			<div class="cart_main">
				<div class="cart-logo">
					<a href="#"></a>
				</div>
			</div>
		</div>
		<div class="main">
			<div class="cart_t">
				<i></i> 请在
				<b>10分00秒</b> 内提交订单，下单后您另有30分钟的支付时间。
			</div>
			<div class="cart-x">
				<div class="tit">
					<table>
						<tr>
							<th class="td01">商品信息</th>
							<th class="td02">单价</th>
							<th class="td03">数量</th>
							<th class="td04">小计</th>
							<th class="td05">操作</th>
						</tr>
					</table>
				</div>
				<!-- 中间商品数据由js拼接出来 -->
				<div class="item-list">
					<div class="catr_list" style="display: none;">
						<table>
							<tr>
								<td class="td01">
									<div class="pic">
										<a href="#"><img src="" width="58" height="74"></a>
									</div>
									<div class="fr">
										<div class="name">
											<a href="#">丝蕴Syoss 无硅水润润发乳750ml 护发素</a>
										</div>
										<div class="size">
											规格:750ml
										</div>
									</div>
								</td>
								<td class="td02">
									<span class="m-price">
						     		<span class="u-yen">¥</span>
									<strong class="u-price">39</strong>
									</span>
									<del class="mar_price">
						        		<span class="u-yen">¥</span>
						     		<strong class="u-price">115</strong>
						        </del>
								</td>
								<td class="td03">
									<div class="quantity">
										<a href="#" class="l-y">-</a>
										<input type="text" />
										<a href="#" class="r-y">+</a>
									</div>
								</td>
								<td class="td04">
									<span class="my_price">
						     		<span class="u-yen">¥</span>
									<strong class="u-price">115</strong>
									</span>
								</td>
								<td class="td05">
									<a href="#">删除</a>
								</td>
							</tr>
						</table>
					</div>
				</div>
				<div class="orders">
					<p style=""><span class="u-y">运费</span> 全场满99包邮
					</p>
				</div>
			</div>

			<div class="cart-j">
				<div class="sykj">
					<a href="#">使用卡券<i class="down"></i> </a>
					已成功使用<b>0</b>张卡券 <input type="button" style="display:none;" value="取消使用" id="cancelUse"></div>
				<div class="cart-m" style="display:none;" id="couponUpDownDiv">
					<div class="cart-m-t">
						<label>激活新卡劵:</label>
						<span>优惠券（含代金券）</span>
						<input id="couponSn" name="couponSn" type="text" class="num" value="请输入激活码" />
						<input id="couponSnBtn" name="couponSnBtn" type="button" class="but" value="激活" />
						<div class="cart-m-t-error" style="display:none;">您输入的激活码有误</div>
					</div>
					<img src="//h5rsc.vipstatic.com/lefeng_pc/images/page/cart-min3.png" style="visibility: hidden;position:absolute; top:0;left:0">
					<div class="cart-m-b">
						<div class="tit">
							<ul id="page_nav">
								<li class="cur">全场券(<b>0</b>)</li>
								<li>专场券(<b>0</b>)</li>
							</ul>
							<p>"专场券"和"全场券"不能同时使用。</p>
						</div>
						<div class="main">
							<p>注：多个专场可使用多张，同一个专场只可使用1张。</p>
							<!--专场卷-->
							<div id="cycle">
								<table id="book7_1" width="100%">
								</table>
								<!--全场卷-->
								<table style="display:none" width="100%" id="book7_2">
								</table>
							</div>
						</div>
					</div>

				</div>

				<div class="cart-b">
					<ul id="amount_cart">
						<ul id="totalPayPrice">
							<li>
								<label class="fl">
								共<b class="num1">0</b>件商品  商品金额
							</label>
								<span class="fr">
								<span class="u-yen">¥</span>
								<strong class="u-price sum1">0</strong>
								</span>
							</li>
						</ul>
					</ul>
				</div>
				<div class="cart-b cart-bt">
					<ul id="totalPayPrice">
						<li class="ov-pre">
							<label class="fl">
								总金额
							</label>
							<span class="fr">
								<span class="u-yen">¥</span>
							<strong class="u-price sum1">0</strong>
							</span>
						</li>
					</ul>
				</div>
				<div class="cart-js">
					<div class="fl">
						<a href="http://www.lefeng.com">继续购物</a>
						<a href="#"></a>
					</div>
					<div class="fr">
						<span id="cleanCart" style="display:none;"> 
                    结算时间已过，购物车被清空了~重新
                    <input name="" type="button" value="挑选商品" class="txsp" />
                </span>
						<input name="" type="button" value="立即结算" class="pre" id="settlement" />
					</div>
				</div>
			</div>

		</div>
		<script type="text/javascript" src="script/thirdplugins/jquery-1.11.3.js"></script>
		<script type="text/javascript" src="script/thirdplugins/cookie.js"></script>
		<script>
			//封装函数商品列表创建

			;
			(function() {
				function gooslist(sid, num) {
					$.ajax({
						url: 'http://10.31.162.27:8087/lfjk/php/lefeng.php',
						dataType: 'json'
					}).done(function(data) {
						$.each(data, function(index, value) {
							if(sid == value.sid) { //比较当前传入sid跟数据比较
								var clonegoodlist = $('.catr_list:hidden').clone(true, true);
								clonegoodlist.find('.pic img').attr('src', value.url);
								clonegoodlist.find('.pic img').attr('sid', value.sid);
								clonegoodlist.find('.name a').html(value.title);
								clonegoodlist.find('.td02 .u-price').html(value.price);
								clonegoodlist.find('.td02 .mar_price').html(value.old_price);
								clonegoodlist.find('.td04 .u-price').html(value.price);
								clonegoodlist.find('.td03 input').val(num);
								clonegoodlist.css('display', 'block');
								$('.item-list').append(clonegoodlist);
								calcprice();
							}
						});
					});

				}
				gooslist();

				//渲染商品列表
				if(getcookie('cooksid') && getcookie('cookienum')) {
					var sid = getcookie('cooksid').split(',');
					var num = getcookie('cookienum').split(',');
					$.each(sid, function(index, value) {
						gooslist(sid[index], num[index]);
					});
				}

				//计算总价数量和数量
				function calcprice() {
					var allprice = 0;
					var allcount = 0;
					$('.catr_list:visible').each(function() {
						allprice += parseFloat($(this).find('.td04 .u-price').html());
						allcount += parseInt($(this).find('.td03 input').val());

					});
					$('.sum1').html(allprice);
					$('.num1').html(allcount);
				}

				//改变商品的数量
				$('.r-y').on('click', function() {
					var addvalue = $(this).parents('.catr_list').find('.td03 input').val();
					addvalue++;
					if(addvalue > 99) {
						addvalue = 99
					}
					$(this).parents('.catr_list').find('.td03 input').val(addvalue);
					$(this).parents('.catr_list').find('.td04 .u-price').html(sumprice($(this)));
					calcprice();
					changecookie($(this));
				})
				$('.l-y').on('click', function() {
					var addvalue = $(this).parents('.catr_list').find('.td03 input').val();
					addvalue--;
					if(addvalue <= 0) {
						addvalue = 1
					}
					$(this).parents('.catr_list').find('.td03 input').val(addvalue);
					$(this).parents('.catr_list').find('.td04 .u-price').html(sumprice($(this)));
					calcprice();
					changecookie($(this));
				})

				// 验证输入框
				$('.td03 input').on('input', function() {
					var reg = /^\d+$/g;
					if(reg.test($(this).val())) {
						var $value = $(this).val();
						if($value > 99) {
							$(this).val(99);
						} else if($value <= 0) {
							$(this).val(1);
						} else {
							$(this).val($value);
						}
					} else {
						$(this).val(1);
					}
					$(this).parents('.catr_list').find('.td04 .u-price').html(sumprice($(this)));
					calcprice();
					changecookie($(this));
				});

				//封装函数实现价格的计算
				function sumprice(obj) {
					var $singleprice = parseFloat(obj.parents('.catr_list').find('.td02 .u-price').html());
					var $addvalue = parseInt(obj.parents('.catr_list').find('.td03 input').val());
					return($singleprice * $addvalue).toFixed(2);
				}

				//将改变的值存放在cookie
				var sidarr = []; //编号
				var numarr = []; //商品数量
				function cookietoarray() { //取cookie转数组
					if(getcookie('cooksid') && getcookie('cookienum')) {
						sidarr = getcookie('cooksid').split(',');
						numarr = getcookie('cookienum').split(',');
					}

				}
				//将改变的值存到cookie
				//当前改变数量的商品列表找到对应的cookie里面的sid比较找到位置
				function changecookie(obj) {
					cookietoarray();
					var sid = obj.parents('.catr_list').find('.pic img').attr('sid');
					numarr[$.inArray(sid, sidarr)] = obj.parents('.catr_list').find('.td03 input').val();
					addcookie('cookienum', numarr.toString(), 7);

				}

				//删除
				$('.catr_list').on('click', '.td05 a', function() {
					if(window.confirm('你确定要删除嘛？？么么')){
						$(this).parents('.catr_list').remove();
						deletecookie($(this).parent('.catr_list').find('.pic img').attr('sid'),sidarr);
					}
					
				})

				//删除cookie-------------------------------
				function deletecookie(sid) {
					cookietoarray();
					var $index = $.inArray(sid,sidarr);
					sidarr.splice($index, 1);
					numarr.splice($index, 1);
					addcookie('cooksid', sidarr.toString(), 7);
					addcookie('cookienum', numarr.toString(), 7);
				}

				//倒计时-----------------------

				var jishi = document.querySelector('.cart_t b');

				function double(n) {
					return n < 10 ? '0' + n : n;
				}

				function time() {

					var futureTime = new Date('2020-2-28 15:07:00'); //未来时间
					var nowTime = new Date(); //当前的时间
					//时间可以进行相减运算,结果是毫秒数
					var sec=parseInt((futureTime-nowTime)/1000);  //秒
					var min=parseInt(sec%3600/60);
					var sec=sec%60;
					return jishi.innerHTML = double(min) + '分' + double(sec) + '秒';
				}
				jishi.innerHTML = time();

				setInterval(function() {
					jishi.innerHTML = time();
				}, 1000);
			})();
		</script>
	</body>

</html>